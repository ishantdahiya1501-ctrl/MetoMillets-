document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("cartPageContent");function n(){return window.cartManager?window.cartManager.cart:window.utils.loadFromLocalStorage("meToMilletsCart")||[]}function a(){const i=n();if(!i||0===i.length)return void(t.innerHTML='\n                <div class="empty-cart-message">\n                    <i class="fas fa-shopping-cart fa-3x" style="color: var(--medium-gray); margin-bottom: 1rem;"></i>\n                    <h2>Your cart is empty</h2>\n                    <p>Looks like you haven\'t added any chocolates yet.</p>\n                    <a href="products.html" class="btn btn-primary" style="margin-top: 1rem;">Continue Shopping</a>\n                </div>\n            ');const e=function(t){const n=t.reduce((t,n)=>t+(n.price||0)*(n.quantity||1),0),a=n>500||0===n?0:50,i=.08*(n+a);return{subtotal:n,shipping:a,tax:i,total:n+a+i}}(i),r=i.map(t=>`\n            <div class="cart-item-row" data-id="${t.id}">\n                <img src="${t.image||"../images/products/default.png"}" alt="${t.name}">\n                <div class="item-details">\n                    <h4>${t.name}</h4>\n                    <p>Price: ${window.utils.formatPrice(t.price)}</p>\n                </div>\n                <div class="quantity-control">\n                    <button class="quantity-btn decrease" data-id="${t.id}">-</button>\n                    <span class="quantity">${t.quantity}</span>\n                    <button class="quantity-btn increase" data-id="${t.id}">+</button>\n                </div>\n                <div class="item-total-price">\n                    <strong>${window.utils.formatPrice(t.price*t.quantity)}</strong>\n                    <button class="remove-btn" data-id="${t.id}" title="Remove item">&times;</button>\n                </div>\n            </div>\n        `).join("");t.innerHTML=`\n            <div class="cart-grid">\n                <div class="cart-items-list">\n                    ${r}\n                </div>\n                <div class="cart-summary">\n                    <h3>Order Summary</h3>\n                    <div class="summary-row">\n                        <span>Subtotal</span>\n                        <span id="summarySubtotal">${window.utils.formatPrice(e.subtotal)}</span>\n                    </div>\n                    <div class="summary-row">\n                        <span>Shipping</span>\n                        <span id="summaryShipping">${0===e.shipping?"Free":window.utils.formatPrice(e.shipping)}</span>\n                    </div>\n                    <div class="summary-row">\n                        <span>Tax (8%)</span>\n                        <span id="summaryTax">${window.utils.formatPrice(e.tax)}</span>\n                    </div>\n                    <div class="summary-row total">\n                        <span>Grand Total</span>\n                        <span id="summaryTotal">${window.utils.formatPrice(e.total)}</span>\n                    </div>\n                    <div class="cart-actions">\n                        <a href="checkout.html" class="btn btn-primary">Proceed to Checkout</a>\n                        <a href="products.html" class="btn btn-secondary">Continue Shopping</a>\n                    </div>\n                </div>\n            </div>\n        `,document.querySelectorAll(".quantity-btn.decrease").forEach(btn=>{btn.addEventListener("click",evt=>{const id=evt.target.dataset.id;const item=n().find(it=>String(it.id)===id);if(item){window.cartManager.updateQuantity(id,item.quantity-1);a()}})}),document.querySelectorAll(".quantity-btn.increase").forEach(btn=>{btn.addEventListener("click",evt=>{const id=evt.currentTarget.dataset.id;const item=n().find(it=>String(it.id)===id);if(item){window.cartManager.updateQuantity(id,item.quantity+1);a()}})}),document.querySelectorAll(".remove-btn").forEach(btn=>{btn.addEventListener("click",evt=>{const id=evt.currentTarget.dataset.id;confirm("Are you sure you want to remove this item?")&&(window.cartManager.removeFromCart(id),a())})})}a(),window.addEventListener("storage",t=>{"meToMilletsCart"===t.key&&a()})});