function formatPrice(e){return`₹${e.toFixed(2)}`}function generateStarRating(e){const n=Math.floor(e),t=e%1>=.5,a=5-n-(t?1:0);let o="";for(let e=0;e<n;e++)o+='<i class="fas fa-star"></i>';t&&(o+='<i class="fas fa-star-half-alt"></i>');for(let e=0;e<a;e++)o+='<i class="far fa-star"></i>';return o}function debounce(e,n){let t;return function(...a){clearTimeout(t),t=setTimeout(()=>{clearTimeout(t),e(...a)},n)}}function checkTemperature(){return 15*Math.random()+20>30}function saveToLocalStorage(e,n){try{return localStorage.setItem(e,JSON.stringify(n)),!0}catch(e){return console.error("Error saving to localStorage:",e),!1}}function loadFromLocalStorage(key){try{const raw=localStorage.getItem(key);if(!raw)return null;const trimmed = raw.trim();const first = trimmed.charAt(0);const looksLikeJson = ['{','[','"','-','0','1','2','3','4','5','6','7','8','9','t','f','n'].includes(first);if(!looksLikeJson){return raw}try{return JSON.parse(raw)}catch(parseErr){console.warn(`Failed to JSON.parse value for key ${key}; returning raw string`,parseErr);return raw}}catch(e){return console.error("Error loading from localStorage:",e),null}}function showNotification(e,n="success"){document.querySelectorAll(".notification").forEach(e=>e.remove());const t=document.createElement("div");t.className=`notification notification-${n}`;const a=document.createElement("span");a.textContent=e;const o=document.createElement("button");if(o.className="close-notification",o.innerHTML="&times;",t.appendChild(a),t.appendChild(o),document.body.appendChild(t),!document.querySelector("#notification-styles")){const e=document.createElement("style");e.id="notification-styles",e.textContent="\n            .notification {\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                padding: 15px 20px;\n                border-radius: 8px;\n                color: white;\n                font-weight: 600;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                min-width: 300px;\n                max-width: 400px;\n                z-index: 10000;\n                animation: slideIn 0.3s ease;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n            }\n            .notification-success {\n                background: linear-gradient(135deg, #2E8B57, #3CB371);\n            }\n            .notification-error {\n                background: linear-gradient(135deg, #DC143C, #FF4500);\n            }\n            .notification-info {\n                background: linear-gradient(135deg, #1E90FF, #4169E1);\n            }\n            .notification-warning {\n                background: linear-gradient(135deg, #FFA500, #FF8C00);\n            }\n            .close-notification {\n                background: none;\n                border: none;\n                color: white;\n                font-size: 1.5rem;\n                cursor: pointer;\n                margin-left: 10px;\n                line-height: 1;\n            }\n            @keyframes slideIn {\n                from {\n                    transform: translateX(100%);\n                    opacity: 0;\n                }\n                to {\n                    transform: translateX(0);\n                    opacity: 1;\n                }\n            }\n            @keyframes slideOut {\n                from {\n                    transform: translateX(0);\n                    opacity: 1;\n                }\n                to {\n                    transform: translateX(100%);\n                    opacity: 0;\n                }\n            }\n        ",document.head.appendChild(e)}const r=setTimeout(()=>{t.style.animation="slideOut 0.3s ease",setTimeout(()=>t.remove(),300)},5e3);t.querySelector(".close-notification").addEventListener("click",()=>{clearTimeout(r),t.style.animation="slideOut 0.3s ease",setTimeout(()=>t.remove(),300)})}function ensurePageLoader(){if(document.getElementById("pageLoader"))return;if(!document.querySelector("#page-loader-styles")){const e=document.createElement("style");e.id="page-loader-styles",e.textContent="\n            .page-loader {\n                position: fixed;\n                inset: 0;\n                display: none;\n                align-items: center;\n                justify-content: center;\n                background: var(--cream, #fff);\n                z-index: 9999;\n            }\n            .page-loader.is-visible { display: flex; }\n\n            .page-loader__inner {\n                display: grid;\n                place-items: center;\n                gap: 12px;\n                padding: 18px 16px;\n                border-radius: 14px;\n                background: var(--white, #fff);\n                border: 1px solid var(--medium-gray, #e5e5e5);\n                box-shadow: var(--shadow-md, 0 10px 24px rgba(0,0,0,0.10));\n                min-width: 220px;\n            }\n\n            .page-loader__spinner {\n                width: 44px;\n                height: 44px;\n                border-radius: 50%;\n                border: 4px solid rgba(0,0,0,0.10);\n                border-top-color: var(--gold, #d4af37);\n                animation: pageLoaderSpin 0.85s linear infinite;\n            }\n\n            .page-loader__text {\n                font-weight: 800;\n                color: var(--dark-chocolate, #3d2b2b);\n                letter-spacing: 0.02em;\n            }\n\n            @keyframes pageLoaderSpin {\n                to { transform: rotate(360deg); }\n            }\n        ",document.head.appendChild(e)}const e=document.createElement("div");e.id="pageLoader",e.className="page-loader",e.setAttribute("aria-hidden","true"),e.innerHTML='\n        <div class="page-loader__inner" role="status" aria-live="polite">\n            <div class="page-loader__spinner" aria-hidden="true"></div>\n            <div class="page-loader__text">Loading…</div>\n        </div>\n    ',document.body.appendChild(e)}function showPageLoader(){ensurePageLoader();const e=document.getElementById("pageLoader");e&&(e.classList.add("is-visible"),e.setAttribute("aria-hidden","false"))}function hidePageLoader(){const e=document.getElementById("pageLoader");e&&(e.classList.remove("is-visible"),e.setAttribute("aria-hidden","true"))}window.utils={formatPrice:formatPrice,generateStarRating:generateStarRating,debounce:debounce,checkTemperature:checkTemperature,saveToLocalStorage:saveToLocalStorage,loadFromLocalStorage:loadFromLocalStorage,showNotification:showNotification};try{ensurePageLoader()}catch(e){}window.addEventListener("load",()=>{hidePageLoader()}),window.addEventListener("pageshow",e=>{e.persisted&&hidePageLoader()}),window.addEventListener("beforeunload",()=>{showPageLoader()}),document.addEventListener("click", (e) => {
    try {
        // If a payment is actively in progress, block navigation clicks to avoid losing state
        if (window._paymentInProgress) {
            const anchor = e.target && e.target.closest ? e.target.closest('a[href]') : null;
            if (anchor) {
                e.preventDefault();
                e.stopPropagation && e.stopPropagation();
                console.warn('Navigation click blocked while payment is in progress');
                return;
            }
        }

        const n = e.target && e.target.closest ? e.target.closest("a[href]") : null;
        if (!n) return;
        const t = (n.getAttribute("href") || "").trim();
        if (!t || t === "#" || t.startsWith('#')) return;
        if (t.startsWith('mailto:') || t.startsWith('tel:') || t.startsWith('javascript:') || n.hasAttribute('download')) return;
        if ((n.getAttribute('target') || '').toLowerCase() === '_blank') return;
        if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
        showPageLoader();
    } catch (err) {
        // Fall through silently
    }
});

window.pageLoader={show:showPageLoader,hide:hidePageLoader};

// Initialize payment-in-progress flag to false to avoid accidentally blocking navigation
try{ if (typeof window !== 'undefined') window._paymentInProgress = false; }catch(e){}