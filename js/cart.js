class CartManager{constructor(){this.cart=this.loadCart(),this.wishlist=this.loadWishlist(),this.checkoutGuardBound=!1,this.init()}init(){this.updateCartCount(),this.updateWishlistCount(),this.bindCheckoutGuards(),this.updateCheckoutState()}loadCart(){return window.utils.loadFromLocalStorage("meToMilletsCart")||[]}saveCart(){window.utils.saveToLocalStorage("meToMilletsCart",this.cart),this.updateCartCount(),this.updateCheckoutState()}addToCart(t,e=1){const id=String(t.id);const existing=this.cart.find(item=>String(item.id)===id);if(existing){existing.quantity+=e}else{this.cart.push({...t,id:id,quantity:e,addedAt:(new Date).toISOString()})}this.saveCart(),window.utils.showNotification(`${t.name} added to cart!`,"success"),!0}removeFromCart(t){const id=String(t);return this.cart=this.cart.filter(item=>String(item.id)!==id),this.saveCart(),window.utils.showNotification("Item removed from cart","info"),!0} updateQuantity(t,e){const id=String(t);const s=this.cart.find(item=>String(item.id)===id);if(s){if(e<=0){this.removeFromCart(id)}else{s.quantity=e;this.saveCart()}}return !0} clearCart(){return this.cart=[],this.saveCart(),this.updateCheckoutState(),!0}getCartTotal(){return this.cart.reduce((t,e)=>t+e.price*e.quantity,0)}getCartCount(){return this.cart.reduce((t,e)=>t+e.quantity,0)}updateCartCount(){const t=document.getElementById("cartCount"),e=document.getElementById("mobileCartCount"),i=document.getElementById("cartTotal");t&&(t.textContent=this.getCartCount()),e&&(e.textContent=this.getCartCount()),i&&(i.textContent=window.utils.formatPrice(this.getCartTotal())),this.updateCheckoutState()}getCheckoutUrl(){return(window.location&&window.location.pathname?window.location.pathname:"").replace(/\\/g,"/").toLowerCase().includes("/pages/")?"checkout.html":"pages/checkout.html"}bindCheckoutGuards(){this.checkoutGuardBound||(this.checkoutGuardBound=!0,document.addEventListener("click",t=>{const e=t.target.closest("#checkoutBtn");if(!e)return;const i=e.classList.contains("is-disabled")||"true"===e.getAttribute("aria-disabled");if(t.preventDefault(),i)return void(window.utils&&window.utils.showNotification("Add items to checkout.","info"));const s=e.getAttribute("href")||this.getCheckoutUrl();window.location.href=s}))}updateCheckoutState(){const t=document.getElementById("checkoutBtn");if(!t)return;let e=document.getElementById("checkoutHint");e||(e=document.createElement("div"),e.id="checkoutHint",e.className="checkout-hint",t.insertAdjacentElement("afterend",e)),this.cart&&this.cart.length>0?(t.classList.remove("is-disabled"),t.setAttribute("aria-disabled","false"),t.setAttribute("href",this.getCheckoutUrl()),e.textContent="",e.style.display="none"):(t.classList.add("is-disabled"),t.setAttribute("aria-disabled","true"),t.setAttribute("href","#"),e.textContent="Add items to checkout.",e.style.display="block")}renderCartItems(){const t=document.getElementById("cartItems");if(!t)return;if(0===this.cart.length)return t.innerHTML='\n                <div class="empty-cart" id="emptyCart">\n                    <i class="fas fa-shopping-cart"></i>\n                    <p>Your cart is empty</p>\n                    <a href="pages/products.html" class="btn btn-primary">Start Shopping</a>\n                </div>\n            ',void this.updateCheckoutState();let e="";this.cart.forEach(t=>{e+=`\n                <div class="cart-item" data-id="${t.id}">\n                    <div class="cart-item-image">\n                        <img src="${t.image||"/images/icons/logo.png"}" alt="${t.name}">\n                    </div>\n                    <div class="cart-item-details">\n                        <div class="cart-item-title">${t.name}</div>\n                        <div class="cart-item-price">${window.utils.formatPrice(t.price)}</div>\n                        <div class="cart-item-actions">\n                            <div class="quantity-control">\n                                <button class="quantity-btn decrease">-</button>\n                                <span class="quantity">${t.quantity}</span>\n                                <button class="quantity-btn increase">+</button>\n                            </div>\n                            <button class="remove-item">\n                                <i class="fas fa-trash"></i>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `}),t.innerHTML=e,t.querySelectorAll(".decrease").forEach(btn=>{btn.addEventListener("click",evt=>{const id=evt.target.closest(".cart-item").dataset.id;const item=this.cart.find(it=>String(it.id)===id);if(item){this.updateQuantity(id,item.quantity-1);this.renderCartItems()}})}),t.querySelectorAll(".increase").forEach(btn=>{btn.addEventListener("click",evt=>{const id=evt.target.closest(".cart-item").dataset.id;const item=this.cart.find(it=>String(it.id)===id);if(item){this.updateQuantity(id,item.quantity+1);this.renderCartItems()}})}),t.querySelectorAll(".remove-item").forEach(btn=>{btn.addEventListener("click",evt=>{const id=evt.currentTarget.closest(".cart-item").dataset.id;this.removeFromCart(id);this.renderCartItems()})}),this.updateCheckoutState()}loadWishlist(){return window.utils.loadFromLocalStorage("meToMilletsWishlist")||[]}saveWishlist(){window.utils.saveToLocalStorage("meToMilletsWishlist",this.wishlist),this.updateWishlistCount()}addToWishlist(t){return this.wishlist.find(e=>String(e.id)===String(t.id))?(window.utils.showNotification(`${t.name} is already in your wishlist!`,"info"),!1):(this.wishlist.push({...t,addedAt:(new Date).toISOString()}),this.saveWishlist(),window.utils.showNotification(`${t.name} added to wishlist!`,"success"),!0)}removeFromWishlist(t){const id=String(t);this.wishlist=this.wishlist.filter(e=>String(e.id)!==id);this.saveWishlist();window.utils.showNotification("Item removed from wishlist","info");return !0} getWishlistCount(){return this.wishlist.length}updateWishlistCount(){const t=document.getElementById("wishlistCount"),e=document.getElementById("mobileWishlistCount"),i=document.getElementById("mobileWishlistCountTop");t&&(t.textContent=this.getWishlistCount()),e&&(e.textContent=this.getWishlistCount()),i&&(i.textContent=this.getWishlistCount())}renderWishlistItems(t){const e=t?"string"==typeof t?document.querySelector(t):t instanceof Element?t:document.getElementById("wishlistItems"):document.getElementById("wishlistItems");if(!e)return;if(0===this.wishlist.length)return void(e.innerHTML='\n                <div class="empty-wishlist" id="emptyWishlist">\n                    <i class="far fa-heart"></i>\n                    <p>Your wishlist is empty</p>\n                    <a href="pages/products.html" class="btn btn-primary">Explore Chocolates</a>\n                </div>\n            ');let i="";this.wishlist.forEach(t=>{i+=`\n                <div class="wishlist-item" data-id="${t.id}">\n                    <div class="wishlist-item-image">\n                        <img src="${t.image||"/images/icons/logo.png"}" alt="${t.name}">\n                    </div>\n                    <div class="wishlist-item-details">\n                        <div class="wishlist-item-title">${t.name}</div>\n                        \n                        <div class="wishlist-item-actions">\n                            <button class="btn btn-primary add-to-cart-from-wishlist">\n                                üõçÔ∏è Buy Now\n                            </button>\n                            <button class="remove-from-wishlist">\n                                <i class="fas fa-trash"></i>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `}),e.innerHTML=i,e.querySelectorAll(".add-to-cart-from-wishlist").forEach(btn=>{btn.addEventListener("click",evt=>{const id=evt.target.closest(".wishlist-item").dataset.id;const i=this.wishlist.find(it=>String(it.id)===id);if(i){this.addToCart(i);this.renderCartItems()}})}),e.querySelectorAll(".remove-from-wishlist").forEach(btn=>{btn.addEventListener("click",evt=>{const id=evt.target.closest(".wishlist-item").dataset.id;this.removeFromWishlist(id);this.renderWishlistItems(t)})})}}const cartManager=new CartManager;window.cartManager=cartManager,window.addEventListener("headerLoaded",()=>{cartManager.updateCartCount(),cartManager.updateWishlistCount(),cartManager.updateCheckoutState()});

