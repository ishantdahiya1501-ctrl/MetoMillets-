class ChocolateChatbot{constructor(){this.messages=[],this.isOpen=!1,this.init()}init(){this.loadMessages(),this.setupEventListeners(),0===this.messages.length&&this.addBotMessage("Hello! I'm your chocolate assistant. How can I help you find your perfect chocolate today?"),this.renderMessages()}setupEventListeners(){const e=document.getElementById("chatbotTrigger"),t=document.getElementById("closeChatbot"),s=document.getElementById("sendMessage"),o=document.getElementById("chatbotInput");e&&e.addEventListener("click",e=>{e.stopPropagation(),this.toggleChatbot()}),t&&t.addEventListener("click",e=>{e.stopPropagation(),this.closeChatbot()}),s&&s.addEventListener("click",e=>{e.stopPropagation(),this.sendMessage()}),o&&o.addEventListener("keypress",e=>{"Enter"===e.key&&(e.stopPropagation(),this.sendMessage())});const n=document.querySelectorAll(".suggestion-btn");n&&n.length&&n.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const s=e.dataset.question;s&&(this.addUserMessage(s),this.showTypingIndicator(),setTimeout(()=>{this.removeTypingIndicator(),this.generateResponse(s)},1e3))})}),document.addEventListener("click",t=>{const s=document.getElementById("chatbotContainer");this.isOpen&&s&&!s.contains(t.target)&&t.target!==e&&!e.contains(t.target)&&this.closeChatbot()})}toggleChatbot(){const e=document.getElementById("chatbotContainer");if(e)if(this.isOpen=!this.isOpen,this.isOpen){e.classList.add("show"),document.getElementById("chatbotInput").focus();const t=document.querySelector(".notification-dot");t&&(t.style.display="none")}else e.classList.remove("show")}openChatbot(){const e=document.getElementById("chatbotContainer");if(!e)return;this.isOpen=!0,e.classList.add("show"),document.getElementById("chatbotInput").focus();const t=document.querySelector(".notification-dot");t&&(t.style.display="none")}closeChatbot(){const e=document.getElementById("chatbotContainer");e&&(this.isOpen=!1,e.classList.remove("show"))}addMessage(e,t){const s={text:e,sender:t,timestamp:(new Date).toISOString()};this.messages.push(s),this.saveMessages(),this.renderMessages();const o=document.getElementById("chatbotMessages");o&&(o.scrollTop=o.scrollHeight)}addBotMessage(e){this.addMessage(e,"bot")}addUserMessage(e){this.addMessage(e,"user")}sendMessage(){const e=document.getElementById("chatbotInput"),t=e.value.trim();t&&(this.addUserMessage(t),e.value="",this.showTypingIndicator(),setTimeout(()=>{this.removeTypingIndicator(),this.generateResponse(t)},1e3))}showTypingIndicator(){const e=document.getElementById("chatbotMessages");if(!e)return;const t=document.createElement("div");t.className="chatbot-message bot typing-indicator",t.innerHTML='\n            <div class="typing">\n                <span></span>\n                <span></span>\n                <span></span>\n            </div>\n        ',e.appendChild(t),e.scrollTop=e.scrollHeight}removeTypingIndicator(){const e=document.querySelector(".typing-indicator");e&&e.remove()}generateResponse(e){const t=e.toLowerCase();let s="";s=t.includes("hello")||t.includes("hi")||t.includes("hey")?"Hello there! I'm your chocolate assistant. Ready to help you discover delicious, ethical chocolates!":t.includes("milk chocolate")?"We specialize in premium dark chocolates made with natural sweeteners. Our entire collection is focused on rich, dark chocolate experiences. Would you like to hear about our bestsellers?":t.includes("dark chocolate")?"You've come to the right place! All our chocolates are dark chocolates. Our Dark 85% with Himalayan Salt is a bestseller, and the Pure Dark 90% is perfect for true connoisseurs. Would you like to know about specific cocoa percentages?":t.includes("gift")||t.includes("present")?"Perfect! We have beautiful gift hampers for every occasion. Explore our Gift Hampers collection, or try our Gift Wizard for personalized recommendations!":t.includes("sugar")||t.includes("healthy")?"All our chocolates are 100% processed-free sugar! We use only honey and dates as natural sweeteners. They're also packed with sorghum for added nutrition and are free from artificial preservatives.":t.includes("price")||t.includes("cost")||t.includes("how much")?"Our dark chocolates start at â‚¹289.00 and our gift boxes begin at â‚¹1,749. You can see the full collection on our shop page!":t.includes("recommend")||t.includes("suggest")||t.includes("what should")?"I'd love to help! Are you looking for something sweet or less sweet? For yourself or as a gift? You can also take our Flavor Quiz on the homepage for personalized recommendations!":t.includes("allergen")||t.includes("nut")||t.includes("dairy")?"Most of our chocolates are nut-free, but some contain almonds. All allergen information is clearly listed on each product page. We have many completely allergen-free options too!":t.includes("subscription")||t.includes("subscribe")?"We offer flexible chocolate subscriptions! You can choose delivery frequency (every 2, 4, or 8 weeks), skip or pause anytime, and customize your box. Check it out in your account!":t.includes("shipping")||t.includes("delivery")||t.includes("ship")?"We offer standard (3-5 days) and expedited (1-2 days) shipping. During hot weather, we recommend expedited shipping to ensure your chocolate arrives perfectly. Free shipping on orders over $50!":t.includes("millet")||t.includes("healthy")?"Sorghum (Jowar) is a nutritious ancient grain. It adds a gentle crunch, is naturally gluten-free, and is often enjoyed for its fiber and antioxidant contentâ€”paired with dark chocolate, it's a delicious wholesome combo!":t.includes("thank")||t.includes("thanks")?"You're very welcome! Is there anything else I can help you with today?":t.includes("bye")||t.includes("goodbye")?"Goodbye! Enjoy your chocolate journey. Remember to treat yourself to something sweet today! ðŸ«":"That's interesting! For personalized recommendations, you can take our Flavor Quiz on the homepage. Or tell me more about what you're looking for - sweet/less sweet, for yourself/as a gift?",this.addBotMessage(s)}renderMessages(){const e=document.getElementById("chatbotMessages");e&&(e.innerHTML="",this.messages.forEach(t=>{const s=document.createElement("div");s.className=`chatbot-message ${t.sender}`;const o=new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),n=document.createElement("div");n.className="message-content";const a=document.createElement("p");a.textContent=t.text;const i=document.createElement("span");i.className="message-time",i.textContent=o,n.appendChild(a),n.appendChild(i),s.appendChild(n),e.appendChild(s)}),e.scrollTop=e.scrollHeight)}saveMessages(){this.messages.length>50&&(this.messages=this.messages.slice(-50)),window.utils.saveToLocalStorage("chatbotMessages",this.messages)}loadMessages(){this.messages=window.utils.loadFromLocalStorage("chatbotMessages")||[]}showNotification(){const e=document.querySelector(".notification-dot");e&&(e.style.display="block")}}function ensureChatbotInitialized(){if(window.chatbot)return window.chatbot;try{return window.chatbot=new ChocolateChatbot,window.chatbot}catch{return null}}function bootstrapLazyChatbot(){const e=document.getElementById("chatbotTrigger");if(!e)return;let t=!1;const s=e=>{t||(t=!0,ensureChatbotInitialized()),window.chatbot&&"function"==typeof window.chatbot.openChatbot&&window.chatbot.openChatbot(),e&&e.preventDefault&&e.preventDefault()};e.addEventListener("click",s,{passive:!1}),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||s(e)})}document.addEventListener("DOMContentLoaded",bootstrapLazyChatbot);